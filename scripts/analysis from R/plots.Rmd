---
title: "Demand charge plots"
output:
  html_document:
    keep_md: yes
  pdf_document: default
---

# This is the include section

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F ,message = F, warning = F,fig.height= 12, fig.width= 15)
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
library(forcats)
library(pander)
library(stringr)
```


         
For each meter (PQ, Wat1, Wat2, and Wat3), there are four plots showing the power (kW) trends per years, months, weekdays and days to help comparing the trends (Nov. 2017 to Apr. 2019)

* Power (kW) trend of a day for days (Day 1 to Day 31) per month 
* Power (kW) trend of a day for weekdays (Sunday to Saturday) per month
* Power (kW) trend of a day for months (Jan. to Dec.) per year
* Power (kW) trend of a month for months (Jan. to Dec.) per year

# PQ

## Power (kW) trend of a day for days (Day 1 to Day 31) per month 

```{r}

demand2 <- read_csv(file = "dmd_tidy.csv") %>% 
  mutate_at(vars(c(-avr, -weekday, -index_m, -index_d)), as.factor) %>% 
  mutate(weekday = parse_factor(weekday, levels = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday",
                                                    "Friday", "Saturday")))
# demand <- demand %>% spread(key = meter, value = avr)
# View(demand2)
# str(demand2)

# correct abnormal data

# PQ
demand2 %>% 
  filter(meter == "PQ") %>% 
  ggplot(aes(x = index_d, y = avr, group = month, color = month)) +
  geom_line() +
  xlab("15 mins in a day") + 
  ylab("Power (kW)") +
  ggtitle("PQ 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ day) +
  theme_minimal(base_size = 14) 
```

## Power (kW) trend of a day for weekdays (Sunday to Saturday) per month

```{r}

demand2 %>% 
  filter(meter == "PQ") %>% 
  ggplot(aes(x = index_d, y = avr, group = day, color = month)) +
    geom_line() +
    xlab("15 mins in a day") + 
    ylab("Power (kW)") +
    ggtitle("PQ 15 mins demand charge power (kW)") +
    theme_bw() + 
    facet_wrap(~ weekday) +
    theme_minimal(base_size = 14) 
```

## Power (kW) trend of a day for months (Jan. to Dec.) per year

```{r}
demand2 %>% 
  filter(meter == "PQ") %>% 
  ggplot(aes(x = index_d, y = avr, group = day, color = year)) +
  geom_line() +
  xlab("15 mins in a day") + 
  ylab("Power (kW)") +
  ggtitle("PQ 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ month) +
  theme_minimal(base_size = 14)
```

## Power (kW) trend of a month for months (Jan. to Dec.) per year

```{r}
demand2 %>% 
  filter(meter == "PQ") %>% 
  ggplot(aes(x = index_m, y = avr, color = year)) +
  geom_line() +
  xlab("15 mins in a month") + 
  ylab("Power (kW)") +
  ggtitle("PQ 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ month) +
  theme_minimal(base_size = 14)

```

# Wat 1

## Power (kW) trend of a day for days (Day 1 to Day 31) per month 

```{r fig.height= 12, fig.width= 15}

# Wat1
demand2 %>% 
  filter(meter == "Wat1") %>% 
  ggplot(aes(x = index_d, y = avr, group = month, color = month)) +
  geom_line() +
  xlab("15 mins in a day") + 
  ylab("Power (kW)") +
  ggtitle("Wat1 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ day) +
  theme_minimal(base_size = 14) 
```

## Power (kW) trend of a day for weekdays (Sunday to Saturday) per month

```{r}

demand2 %>% 
  filter(meter == "Wat1") %>% 
  ggplot(aes(x = index_d, y = avr, group = day, color = month)) +
  geom_line() +
  xlab("15 mins in a day") + 
  ylab("Power (kW)") +
  ggtitle("Wat1 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ weekday) +
  theme_minimal(base_size = 14) 
```

## Power (kW) trend of a day for months (Jan. to Dec.) per year

```{r}
demand2 %>% 
  filter(meter == "Wat1") %>% 
  ggplot(aes(x = index_d, y = avr, group = day, color = year)) +
  geom_line() +
  xlab("15 mins in a day") + 
  ylab("Power (kW)") +
  ggtitle("Wat1 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ month) +
  theme_minimal(base_size = 14)
```

## Power (kW) trend of a month for months (Jan. to Dec.) per year

```{r}

demand2 %>% 
  filter(meter == "Wat1") %>% 
  ggplot(aes(x = index_m, y = avr, color = year)) +
  geom_line() +
  xlab("15 mins in a month") + 
  ylab("Power (kW)") +
  ggtitle("Wat1 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ month) +
  theme_minimal(base_size = 14)

```


# Wat 2

## Power (kW) trend of a day for days (Day 1 to Day 31) per month 

```{r fig.height= 12, fig.width= 15}

# Wat2
demand2 %>% 
  filter(meter == "Wat2") %>% 
  ggplot(aes(x = index_d, y = avr, group = month, color = month)) +
  geom_line() +
  xlab("15 mins in a day") + 
  ylab("Power (kW)") +
  ggtitle("Wat2 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ day) +
  theme_minimal(base_size = 14) 
```

## Power (kW) trend of a day for weekdays (Sunday to Saturday) per month

```{R}

demand2 %>% 
  filter(meter == "Wat2") %>% 
  ggplot(aes(x = index_d, y = avr, group = day, color = month)) +
  geom_line() +
  xlab("15 mins in a day") + 
  ylab("Power (kW)") +
  ggtitle("Wat2 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ weekday) +
  theme_minimal(base_size = 14) 
```

## Power (kW) trend of a day for months (Jan. to Dec.) per year

```{r}

demand2 %>% 
  filter(meter == "Wat2") %>% 
  ggplot(aes(x = index_d, y = avr, group = day, color = year)) +
  geom_line() +
  xlab("15 mins in a day") + 
  ylab("Power (kW)") +
  ggtitle("Wat2 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ month) +
  theme_minimal(base_size = 14)
```

## Power (kW) trend of a month for months (Jan. to Dec.) per year

```{r}

demand2 %>% 
  filter(meter == "Wat2") %>% 
  ggplot(aes(x = index_m, y = avr, color = year)) +
  geom_line() +
  xlab("15 mins in a month") + 
  ylab("Power (kW)") +
  ggtitle("Wat2 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ month) +
  theme_minimal(base_size = 14)

```

# Wat 3

## Power (kW) trend of a day for days (Day 1 to Day 31) per month 

```{r fig.height= 12, fig.width= 15}

# Wat3
demand2 %>% 
  filter(meter == "Wat3") %>% 
  ggplot(aes(x = index_d, y = avr, group = month, color = month)) +
  geom_line() +
  xlab("15 mins in a day") + 
  ylab("Power (kW)") +
  ggtitle("Wat3 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ day) +
  theme_minimal(base_size = 14) 
```

## Power (kW) trend of a day for weekdays (Sunday to Saturday) per month

```{r}


demand2 %>% 
  filter(meter == "Wat3") %>% 
  ggplot(aes(x = index_d, y = avr, group = day, color = month)) +
  geom_line() +
  xlab("15 mins in a day") + 
  ylab("Power (kW)") +
  ggtitle("Wat3 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ weekday) +
  theme_minimal(base_size = 14) 
```

## Power (kW) trend of a day for months (Jan. to Dec.) per year

```{r}

demand2 %>% 
  filter(meter == "Wat3") %>% 
  ggplot(aes(x = index_d, y = avr, group = day, color = year)) +
  geom_line() +
  xlab("15 mins in a day") + 
  ylab("Power (kW)") +
  ggtitle("Wat3 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ month) +
  theme_minimal(base_size = 14)
```

## Power (kW) trend of a month for months (Jan. to Dec.) per year

```{r}

demand2 %>% 
  filter(meter == "Wat3") %>% 
  ggplot(aes(x = index_m, y = avr, color = year)) +
  geom_line() +
  xlab("15 mins in a month") + 
  ylab("Power (kW)") +
  ggtitle("Wat3 15 mins demand charge power (kW)") +
  theme_bw() + 
  facet_wrap(~ month) +
  theme_minimal(base_size = 14)
```
